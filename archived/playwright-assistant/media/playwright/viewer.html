<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playwright Viewer</title>
    <style id="dynamic-styles"></style>
</head>
<body>
    <div id="container">
        <!-- Status Bar -->
        <div id="status-bar">
            <span id="connection-status" class="disconnected">Disconnected</span>
            <div id="status-actions">
                <button id="reconnect-btn" title="Reconnect">Reconnect</button>
                <button id="inspector-toggle" title="Enable Inspector">
                    <span class="icon">&#128269;</span> Inspect
                </button>
                <button id="mode-toggle" title="Toggle VNC/Screenshot mode">VNC Mode</button>
            </div>
        </div>

        <!-- Tab Bar -->
        <div id="tab-bar">
            <div id="tabs-container">
                <!-- Tabs will be dynamically added here -->
            </div>
            <button id="new-tab-btn" title="New Tab">+</button>
        </div>

        <!-- Toolbar -->
        <div id="toolbar">
            <div id="nav-controls">
                <button id="back-btn" title="Back">&#8592;</button>
                <button id="forward-btn" title="Forward">&#8594;</button>
                <button id="reload-btn" title="Reload">&#8635;</button>
            </div>
            <input type="text" id="url-bar" placeholder="Enter URL..." />
            <div id="tool-controls">
                <button id="inspector-btn" title="Inspector Mode" class="tool-btn">
                    <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none">
                        <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                    </svg>
                </button>
                <button id="annotate-btn" title="Annotation Mode" class="tool-btn">
                    <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none">
                        <path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
                    </svg>
                </button>
                <button id="record-btn" title="Record Session" class="tool-btn">
                    <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none">
                        <circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="4" fill="currentColor"/>
                    </svg>
                </button>
                <button id="voice-control-btn" title="Voice Control (Ctrl+Shift+V)" class="tool-btn" disabled>
                    <svg class="mic-icon" viewBox="0 0 24 24" width="16" height="16" fill="currentColor">
                        <path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3zm-1-9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1V5z"/>
                        <path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/>
                    </svg>
                    <span id="voice-btn-indicator"></span>
                </button>
                <span id="voice-status"></span>
                <button id="collab-btn" title="Collaboration" class="tool-btn">
                    <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Control Bar (for bidirectional control) -->
        <div id="control-bar">
            <div id="control-status">
                <span id="control-indicator" class="mode-shared">Shared</span>
                <span id="active-controller" class="controller-none">Idle</span>
                <span id="lock-indicator"><span class="lock-icon">&#128274;</span> <span id="lock-text">Locked</span></span>
                <span id="queue-indicator">0 queued</span>
            </div>
            <div id="last-action-info"></div>
            <div id="control-mode-selector">
                <label for="control-mode-select">Mode:</label>
                <select id="control-mode-select">
                    <option value="shared">Shared</option>
                    <option value="user-only">User Only</option>
                    <option value="ai-only">AI Only</option>
                    <option value="locked">Locked</option>
                </select>
            </div>
            <div id="control-buttons">
                <button id="request-control-btn" class="control-btn primary">Request Lock</button>
                <button id="release-control-btn" class="control-btn" disabled>Release Lock</button>
            </div>
        </div>

        <!-- Action Indicator Overlay -->
        <div id="action-indicator"></div>

        <!-- Annotation Toolbar (hidden by default) -->
        <div id="annotation-toolbar" class="hidden">
            <button class="anno-tool active" data-tool="pen" title="Pen">
                <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none">
                    <path d="M12 19l7-7 3 3-7 7-3-3z"/><path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/>
                </svg>
            </button>
            <button class="anno-tool" data-tool="highlighter" title="Highlighter">
                <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none">
                    <path d="M9 11l-6 6v3h9l3-3"/>
                    <path d="m22 12-4.6 4.6a2 2 0 0 1-2.8 0l-5.2-5.2a2 2 0 0 1 0-2.8L14 4"/>
                </svg>
            </button>
            <button class="anno-tool" data-tool="arrow" title="Arrow">
                <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none">
                    <line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/>
                </svg>
            </button>
            <button class="anno-tool" data-tool="rectangle" title="Rectangle">
                <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                </svg>
            </button>
            <button class="anno-tool" data-tool="text" title="Text">
                <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none">
                    <polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/>
                    <line x1="12" y1="4" x2="12" y2="20"/>
                </svg>
            </button>
            <button class="anno-tool" data-tool="eraser" title="Eraser">
                <svg viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" fill="none">
                    <path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21"/>
                    <path d="M22 21H7"/><path d="m5 11 9 9"/>
                </svg>
            </button>
            <div class="anno-separator"></div>
            <input type="color" id="anno-color" value="#ff0000" title="Color">
            <select id="anno-stroke" title="Stroke Width">
                <option value="2">Thin</option>
                <option value="4" selected>Medium</option>
                <option value="8">Thick</option>
            </select>
            <div class="anno-separator"></div>
            <button id="anno-undo" title="Undo">Undo</button>
            <button id="anno-clear" title="Clear All">Clear</button>
            <button id="anno-send" title="Send to Chat">Send to Chat</button>
        </div>

        <!-- Main Viewer Area -->
        <div id="viewer-wrapper">
            <!-- Screenshot Mode -->
            <img id="screenshot" alt="Browser screenshot" />
            <div id="click-overlay"></div>

            <!-- Annotation Canvas -->
            <canvas id="annotation-canvas"></canvas>

            <!-- VNC Mode Container -->
            <div id="vnc-container" class="hidden"></div>

            <!-- Inspector Highlight Overlay (positioned absolutely over screenshot) -->
            <div id="inspector-highlight"></div>

            <!-- Inspector Tooltip (positioned near cursor) -->
            <div id="inspector-tooltip"></div>

            <!-- Inspector Mode Indicator -->
            <div class="inspector-mode-indicator">
                <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" fill="none">
                    <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
                </svg>
                <span>Inspector Mode</span>
            </div>

            <!-- Remote Cursors (for collaboration) -->
            <div id="remote-cursors"></div>

            <!-- Loading Overlay -->
            <div id="loading">
                <div class="spinner"></div>
                <span>Connecting to Playwright...</span>
            </div>

            <!-- Recording Indicator -->
            <div id="recording-indicator" class="hidden">
                <span class="recording-dot"></span>
                <span>Recording</span>
                <span id="recording-time">00:00</span>
            </div>

            <!-- Voice Indicator -->
            <div id="voice-indicator" class="hidden">
                <div class="voice-wave">
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <span id="voice-text">Listening...</span>
            </div>

            <!-- Voice Transcript Display -->
            <div id="voice-transcript-container">
                <div id="voice-transcript"></div>
                <div id="voice-command"></div>
            </div>

            <!-- Voice Feedback Overlay -->
            <div id="voice-feedback-container">
                <div id="voice-feedback"></div>
            </div>

            <!-- Listening Overlay Effect -->
            <div id="listening-overlay"></div>

            <!-- Voice Help Modal -->
            <div id="voice-help">
                <button id="voice-help-close">&times;</button>
                <h3>Voice Commands</h3>
                <ul>
                    <li><strong>"Click [element]"</strong> <span>Click on an element</span></li>
                    <li><strong>"Type [text]"</strong> <span>Type text</span></li>
                    <li><strong>"Go to [URL]"</strong> <span>Navigate to URL</span></li>
                    <li><strong>"Scroll [up/down]"</strong> <span>Scroll the page</span></li>
                    <li><strong>"Go back"</strong> <span>Navigate back</span></li>
                    <li><strong>"Go forward"</strong> <span>Navigate forward</span></li>
                    <li><strong>"Refresh"</strong> <span>Reload the page</span></li>
                    <li><strong>"Take screenshot"</strong> <span>Capture screenshot</span></li>
                    <li><strong>"Search for [text]"</strong> <span>Find on page</span></li>
                    <li><strong>"Stop"</strong> <span>Stop listening</span></li>
                </ul>
            </div>
        </div>

        <!-- Controls -->
        <div id="controls">
            <input type="text" id="type-input" placeholder="Type text and press Enter..." />
        </div>

        <!-- Collaboration Panel (hidden by default) -->
        <div id="collab-panel" class="hidden">
            <div id="collab-header">
                <span>Session: <span id="session-name">Not connected</span></span>
                <button id="collab-close">Ã—</button>
            </div>
            <div id="participants-list"></div>
            <div id="collab-actions">
                <button id="create-session-btn">Create Session</button>
                <button id="join-session-btn">Join Session</button>
                <button id="leave-session-btn" class="hidden">Leave Session</button>
            </div>
            <input type="text" id="invite-link" readonly placeholder="Invite link will appear here" />
        </div>

        <!-- Tab Context Menu -->
        <div id="tab-context-menu">
            <div class="context-menu-item" data-action="reload">Reload</div>
            <div class="context-menu-item" data-action="duplicate">Duplicate</div>
            <div class="context-menu-separator"></div>
            <div class="context-menu-item" data-action="close">Close</div>
            <div class="context-menu-item" data-action="close-others">Close Others</div>
            <div class="context-menu-item" data-action="close-right">Close Tabs to Right</div>
        </div>

        <!-- Recording Panel (hidden by default) -->
        <div id="recording-panel" class="hidden">
            <div id="recording-panel-header">
                <h3>Session Recording</h3>
                <button id="recording-panel-close" title="Close panel">&times;</button>
            </div>
            <div id="recording-panel-content">
                <!-- Recording Controls -->
                <div id="recording-controls">
                    <input type="text" id="recording-name" placeholder="Recording name..." />
                    <button id="start-recording-btn" class="primary-btn">
                        <span class="record-dot"></span> Start Recording
                    </button>
                    <button id="stop-recording-btn" class="danger-btn hidden">
                        <span class="stop-icon"></span> Stop Recording
                    </button>
                </div>

                <!-- Playback Controls -->
                <div id="playback-controls" class="hidden">
                    <div id="playback-progress-container">
                        <div id="playback-progress-bar"></div>
                    </div>
                    <div id="playback-info">
                        <span id="playback-action">0</span> / <span id="playback-total">0</span>
                    </div>
                    <div id="playback-buttons">
                        <button id="play-btn" title="Play">&#9654;</button>
                        <button id="pause-btn" title="Pause" class="hidden">&#10074;&#10074;</button>
                        <button id="stop-playback-btn" title="Stop">&#9632;</button>
                        <button id="step-btn" title="Step Forward">&#10097;</button>
                    </div>
                    <div id="speed-control">
                        <label>Speed:</label>
                        <select id="playback-speed">
                            <option value="0.5">0.5x</option>
                            <option value="1" selected>1x</option>
                            <option value="2">2x</option>
                            <option value="5">5x</option>
                        </select>
                    </div>
                </div>

                <!-- Recordings List -->
                <div id="recordings-list-container">
                    <h4>Saved Recordings</h4>
                    <button id="refresh-recordings-btn">Refresh</button>
                    <div id="recordings-list">
                        <div class="no-recordings">No recordings yet</div>
                    </div>
                </div>

                <!-- Export Options -->
                <div id="export-options" class="hidden">
                    <h4>Export Recording</h4>
                    <select id="export-format">
                        <option value="json">JSON</option>
                        <option value="playwright">Playwright Test</option>
                        <option value="puppeteer">Puppeteer Script</option>
                        <option value="cypress">Cypress Test</option>
                    </select>
                    <button id="export-btn">Export</button>
                    <textarea id="export-output" readonly placeholder="Exported code will appear here..."></textarea>
                    <button id="copy-export-btn">Copy to Clipboard</button>
                </div>
            </div>
        </div>

        <!-- Inspector Panel (optional sidebar for detailed info) -->
        <div id="inspector-panel">
            <div id="inspector-panel-header">
                <h3>Element Inspector</h3>
                <button id="inspector-panel-close" title="Close panel">&times;</button>
            </div>
            <div id="inspector-panel-content">
                <div class="inspector-placeholder">
                    <p>Hover over an element to inspect it</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Inspector Panel Script -->
    <script src="inspector-panel.js"></script>
</body>
</html>
